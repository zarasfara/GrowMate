@page
@using GrowMate.Domain.GardenBeds
@using GrowMate.Domain.GardenTasks
@using GrowMate.Domain.Plants
@model IndexModel
@{
    ViewData["Title"] = "Мой сад";
}

<!-- Hero Section -->
<div class="hero-section">
    <div class="container hero-content">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <h1 class="display-4 fw-bold mb-3 hero-title">🌱 Добро пожаловать в GrowMate!</h1>
                <p class="lead mb-4 hero-subtitle">Ваш умный помощник в управлении садом. Отслеживайте растения,
                    планируйте задачи и выращивайте больше!</p>
                <div class="d-flex gap-2 flex-wrap">
                    <a asp-page="/GardenBeds/Index" class="btn btn-light btn-lg px-4">
                        <i class="bi bi-plus-circle"></i> Добавить растение
                    </a>
                    <a asp-page="/GardenTasks" class="btn btn-outline-light btn-lg px-4"
                       style="color: white; border-color: white;">
                        <i class="bi bi-calendar-check"></i> Создать задачу
                    </a>
                </div>
            </div>
            <div class="col-lg-4 text-center d-none d-lg-block">
                <div class="display-1" style="font-size: 4rem;">🌿🪴🌺</div>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <!-- Статистика -->
    <div class="row g-4 mb-5">
        <div class="col-sm-6 col-lg-3">
            <div class="card border-0 shadow-sm h-100 hover-lift">
                <div class="card-body text-center">
                    <div class="stat-icon success">
                        <span>🌿</span>
                    </div>
                    <h3 class="fw-bold text-success mb-1">@Model.TotalGardenBeds</h3>
                    <p class="text-muted mb-0">Грядок</p>
                </div>
            </div>
        </div>
        <div class="col-sm-6 col-lg-3">
            <div class="card border-0 shadow-sm h-100 hover-lift">
                <div class="card-body text-center">
                    <div class="stat-icon primary">
                        <span>🪴</span>
                    </div>
                    <h3 class="fw-bold text-primary mb-1">@Model.TotalPlants</h3>
                    <p class="text-muted mb-0">Растений</p>
                </div>
            </div>
        </div>
        <div class="col-sm-6 col-lg-3">
            <div class="card border-0 shadow-sm h-100 hover-lift">
                <div class="card-body text-center">
                    <div class="stat-icon warning">
                        <span>⏰</span>
                    </div>
                    <h3 class="fw-bold text-warning mb-1">@Model.PendingTasks</h3>
                    <p class="text-muted mb-0">Ожидающих задач</p>
                </div>
            </div>
        </div>
        <div class="col-sm-6 col-lg-3">
            <div class="card border-0 shadow-sm h-100 hover-lift">
                <div class="card-body text-center">
                    <div class="stat-icon info">
                        <span>✅</span>
                    </div>
                    <h3 class="fw-bold text-info mb-1">@Model.CompletedTasksToday</h3>
                    <p class="text-muted mb-0">Выполнено сегодня</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Tabs Navigation -->
    <ul class="nav nav-pills nav-fill mb-4 shadow-sm rounded" id="mainTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active rounded-start" id="beds-tab" data-bs-toggle="tab" data-bs-target="#beds"
                    type="button" role="tab">
                🌿 Мои грядки
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="plants-tab" data-bs-toggle="tab" data-bs-target="#plants" type="button"
                    role="tab">
                🪴 Растения
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link rounded-end" id="tasks-tab" data-bs-toggle="tab" data-bs-target="#tasks"
                    type="button" role="tab">
                📋 Задачи
            </button>
        </li>
    </ul>

    <!-- Tab Content -->
    <div class="tab-content" id="mainTabsContent">
        <!-- Грядки -->
        <div class="tab-pane fade show active" id="beds" role="tabpanel">
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-white border-0 d-flex justify-content-between align-items-center py-3">
                    <h5 class="mb-0 fw-bold">🌿 Мои грядки</h5>
                    <a asp-page="/GardenBeds/Index" class="btn btn-success btn-sm">
                        <i class="bi bi-plus-circle"></i> Добавить грядку
                    </a>
                </div>
                <div class="card-body p-0">
                    @if (Model.GardenBeds.Any())
                    {
                        <div class="row g-3 p-3">
                            @foreach (var bed in Model.GardenBeds)
                            {
                                <div class="col-md-6 col-lg-4">
                                    <div class="card h-100 border hover-lift">
                                        <div class="card-body">
                                            <div class="d-flex justify-content-between align-items-start mb-3">
                                                <h6 class="fw-bold mb-0">@bed.Name</h6>
                                                <span class="badge rounded-pill @(bed.Type switch
                                                                                {
                                                                                    GardenBedType.Greenhouse => "bg-success",
                                                                                    GardenBedType.OpenGround => "bg-primary",
                                                                                    GardenBedType.Container => "bg-info",
                                                                                    _ => "bg-secondary"
                                                                                })">
                                                    @(bed.Type switch
                                                    {
                                                        GardenBedType.Greenhouse => "🏠 Теплица",
                                                        GardenBedType.OpenGround => "🌾 Открытый грунт",
                                                        GardenBedType.Container => "🪴 Контейнер",
                                                        _ => "📦 Другое"
                                                    })
                                                </span>
                                            </div>
                                            <p class="text-muted small mb-3">
                                                <i class="bi bi-geo-alt"></i> Грядка #@bed.Id
                                            </p>
                                            <div class="d-grid">
                                                <a asp-page="/GardenBeds/Details" asp-route-id="@bed.Id"
                                                   class="btn btn-outline-primary btn-sm">
                                                    Управление <i class="bi bi-arrow-right"></i>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    }
                    else
                    {
                        <div class="text-center py-5">
                            <div class="mb-3 opacity-50" style="font-size: 4rem;">🌱</div>
                            <h5 class="text-muted">У вас пока нет грядок</h5>
                            <p class="text-muted">Создайте свою первую грядку и начните выращивать!</p>
                            <a asp-page="/GardenBeds/Index" class="btn btn-success">Создать грядку</a>
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- Растения -->
        <div class="tab-pane fade" id="plants" role="tabpanel">
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-white border-0 d-flex justify-content-between align-items-center py-3">
                    <h5 class="mb-0 fw-bold">🪴 Мои растения</h5>
                    <a asp-page="/Plants/Index" class="btn btn-primary btn-sm">
                        <i class="bi bi-plus-circle"></i> Добавить растение
                    </a>
                </div>
                <div class="card-body p-0">
                    @if (Model.RecentPlants.Any())
                    {
                        <div class="row g-3 p-3">
                            @foreach (var plant in Model.RecentPlants)
                            {
                                <div class="col-sm-6 col-md-4 col-lg-3">
                                    <div class="card h-100 border-0 shadow-sm hover-lift">
                                        <div class="card-body">
                                            <div class="text-center mb-3">
                                                <div class="plant-emoji-circle">
                                                    <span>
                                                        @(plant.Type switch
                                                        {
                                                            PlantType.Vegetable => "🥕",
                                                            PlantType.Fruit => "🍎",
                                                            PlantType.Berry => "🍓",
                                                            PlantType.Flower => "🌸",
                                                            PlantType.Tree => "🌳",
                                                            PlantType.Herb => "🌿",
                                                            _ => "🌱"
                                                        })
                                                    </span>
                                                </div>
                                            </div>
                                            <h6 class="fw-bold text-center mb-1">@plant.Name</h6>
                                            @if (!string.IsNullOrEmpty(plant.Variety))
                                            {
                                                <p class="text-center text-muted small mb-2">@plant.Variety</p>
                                            }
                                            <div
                                                class="d-flex justify-content-between align-items-center mt-3 pt-3 border-top">
                                                <small class="text-muted">
                                                    <i class="bi bi-calendar3"></i> @((DateTime.Now - plant.PlantingDate).Days) дн.
                                                </small>
                                                <a href="#" class="btn btn-sm btn-outline-primary">
                                                    <i class="bi bi-eye"></i>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    }
                    else
                    {
                        <div class="text-center py-5">
                            <div class="mb-3 opacity-50" style="font-size: 4rem;">🪴</div>
                            <h5 class="text-muted">У вас пока нет растений</h5>
                            <p class="text-muted">Добавьте первое растение и следите за его ростом!</p>
                            <a asp-page="/Plants/Index" class="btn btn-primary">Добавить растение</a>
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- Задачи -->
        <div class="tab-pane fade" id="tasks" role="tabpanel">
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-white border-0 d-flex justify-content-between align-items-center py-3">
                    <h5 class="mb-0 fw-bold">📋 Предстоящие задачи</h5>
                    <a asp-page="/GardenTasks" class="btn btn-warning btn-sm">
                        <i class="bi bi-plus-circle"></i> Создать задачу
                    </a>
                </div>
                <div class="card-body p-0">
                    @if (Model.UpcomingTasks.Any())
                    {
                        <div class="list-group list-group-flush">
                            @foreach (var task in Model.UpcomingTasks.OrderBy(t => t.DueDate))
                            {
                                var isOverdue = task.DueDate.Date < DateTime.Today && !task.IsCompleted;
                                var isToday = task.DueDate.Date == DateTime.Today;

                                <div class="list-group-item @(task.IsCompleted ? "bg-light" : "")">
                                    <div class="row align-items-center">
                                        <div class="col-auto">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox"
                                                       @(task.IsCompleted ? "checked" : "") disabled>
                                            </div>
                                        </div>
                                        <div class="col">
                                            <div class="d-flex justify-content-between align-items-start">
                                                <div>
                                                    <h6 class="mb-1 @(task.IsCompleted ? "text-decoration-line-through text-muted" : "")">
                                                        @task.Title
                                                    </h6>
                                                    <div class="d-flex gap-2 flex-wrap">
                                                        <span class="badge @(task.Type switch
                                                                           {
                                                                               TaskType.Watering => "bg-primary",
                                                                               TaskType.Fertilizing => "bg-success",
                                                                               TaskType.Treatment => "bg-danger",
                                                                               _ => "bg-secondary"
                                                                           })">
                                                            @(task.Type switch
                                                            {
                                                                TaskType.Watering => "💧 Полив",
                                                                TaskType.Fertilizing => "🌾 Подкормка",
                                                                TaskType.Treatment => "🛡️ Обработка",
                                                                _ => "📝 Другое"
                                                            })
                                                        </span>
                                                        <span
                                                            class="badge @(isOverdue ? "bg-danger" : isToday ? "bg-warning" : "bg-secondary")">
                                                            <i class="bi bi-calendar"></i>
                                                            @if (isOverdue)
                                                            {
                                                                <text>Просрочено!</text>
                                                            }
                                                            else if (isToday)
                                                            {
                                                                <text>Сегодня</text>
                                                            }
                                                            else
                                                            {
                                                                @task.DueDate.ToString("dd MMM")
                                                            }
                                                        </span>
                                                    </div>
                                                </div>
                                                <button class="btn btn-sm btn-outline-secondary">
                                                    <i class="bi bi-three-dots-vertical"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    }
                    else
                    {
                        <div class="text-center py-5">
                            <div class="mb-3 opacity-50" style="font-size: 4rem;">📋</div>
                            <h5 class="text-muted">Нет предстоящих задач</h5>
                            <p class="text-muted">Создайте задачу, чтобы не забыть важные дела!</p>
                            <a asp-page="/GardenTasks" class="btn btn-warning">Создать задачу</a>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="row g-4 mb-5">
        <div class="col-md-4">
            <div class="card border-0 shadow-sm text-center h-100 hover-lift">
                    <div class="card-body py-4">
                    <div class="quick-action-icon">📊</div>
                    <h5 class="fw-bold">Статистика</h5>
                    <p class="text-muted">Просматривайте детальную статистику роста ваших растений</p>
                        <a asp-page="/Statistics" class="btn btn-outline-primary">Перейти</a>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card border-0 shadow-sm text-center h-100 hover-lift">
                <div class="card-body py-4">
                    <div class="quick-action-icon">📅</div>
                    <h5 class="fw-bold">Календарь</h5>
                    <p class="text-muted">Планируйте посадки и задачи в удобном календаре</p>
                    <a asp-page="/GardenTasks" class="btn btn-outline-primary">Перейти</a>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card border-0 shadow-sm text-center h-100 hover-lift">
                <div class="card-body py-4">
                    <div class="quick-action-icon">📚</div>
                    <h5 class="fw-bold">База знаний</h5>
                    <p class="text-muted">Изучайте советы и рекомендации по выращиванию</p>
                    <a asp-page="/GardenBeds/Index" class="btn btn-outline-primary">Перейти</a>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Активация вкладок Bootstrap
        var triggerTabList = [].slice.call(document.querySelectorAll('#mainTabs button'))
        triggerTabList.forEach(function (triggerEl) {
            var tabTrigger = new bootstrap.Tab(triggerEl)
            triggerEl.addEventListener('click', function (event) {
                event.preventDefault()
                tabTrigger.show()
            })
        })
    </script>
}

